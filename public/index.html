<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
	<script src="choropleth.js"></script>
	<style type="text/css">
		#map {
			background-color: #fff;
			border: 1px solid #ccc;
		}
		#table {
			width: 100%;
		}
		#table .cell {
			display: inline-block;
			min-width: 100px;
			border: 1px solid lightgrey;
		}
		.background {
			fill: none;
			pointer-events: all;
		}
		#countries, #states {
			fill: #cde;
			stroke: #fff;
			stroke-linejoin: round;
			stroke-linecap: round;
		}
		.country{
			fill: whitesmoke;
		}
		.country-border{
			fill: none;
			stroke: darkslategray;
		}
		.active-land {
			fill: #99CCCC;
			stroke: darkslategray;
		}
		.color-scale-0 {
			fill: #edf8e9;
		}
		.color-scale-1 {
			fill: #bae4b3;
		} 
		.color-scale-2 {
			fill: #74c476;
		}
		.color-scale-3 {
			fill: #31a354;
		}
		.color-scale-4 {
			fill: #006d2c;
		}

	</style>
</head>
<body>
	<div id="map"></div>
	<div id="table"></div>
	<script type="text/javascript">
	  // some function to manipulate other elements 
		var updateTable = function(data){
			var $table = $('#table');
			$table.empty();
			$.each(data,function(key, value){
				// USA: {value: 1, children: {}}
				console.log(key, value)
				if(!value['value']){ return; }
				var domStr = '';
				domStr += "<div class='row'>"
				domStr += "<div class='cell key'>" + key + "</div>"
				domStr += "<div class='cell value'>" + value['value'] + "</div>"
				domStr += "</div>"
				$table.append(domStr);
			})
		};

		var dataObj = {};

		var choropleth = new Choropleth({
			mapSelector: '#map',
			dataStore: dataObj, 
			onClick: function(selection){
				// {zoom: 'state', country: 'USA', state: 'CA'}
				var self = this;
				var info = self.get(selection);
				if(info){
					self.render(selection);
					updateTable(info);
				} else {
					$.ajax({
						url: "/geodata",
						data: selection,
						dataType: 'json',
						success: function(data){
							// data = {'San Francisco': 4, 'Los Angeles': 10, 'San Diego': 3}
							self.insert(data, selection);
							self.render(selection);
							updateTable(self.get(selection));
						}
					});
				};
			}
		})
	</script>
</body>
</html>