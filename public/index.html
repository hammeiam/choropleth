<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
	<script src="choropleth.js"></script>
	<style type="text/css">
		#map {
			background-color: #fff;
			border: 1px solid #ccc;
		}
		.background {
			fill: none;
			pointer-events: all;
		}
		#countries, #states {
			fill: #cde;
			stroke: #fff;
			stroke-linejoin: round;
			stroke-linecap: round;
		}
		.country{
			fill: whitesmoke;
		}
		.country-border{
			fill: none;
			stroke: darkslategray;
		}
		.color-scale-0 {
			fill: #edf8e9;
		}
		.color-scale-1 {
			fill: #bae4b3;
		} 
		.color-scale-2 {
			fill: #74c476;
		}
		.color-scale-3 {
			fill: #31a354;
		}
		.color-scale-4 {
			fill: #006d2c;
		}

	</style>
</head>
<body>
	<div id="map"></div>
	<script type="text/javascript">
		var dataObj = {};
		$.ajax({
			url: "/geodata",
			data: {zoom: 'world'},
			dataType: 'json',
			success: function(data){
				// data = {'San Francisco': 4, 'Los Angeles': 10, 'San Diego': 3}
				choropleth.insert(data, {zoom: 'world'});
				choropleth.render({zoom: 'world'});
			}
		});


		var choropleth = new Choropleth({
			mapSelector: '#map',
			dataStore: dataObj, 
			onClick: function(selection){
				// {zoom: 'state', country: 'USA', state: 'CA'}
				if(choropleth.get(selection)){
					choropleth.render(selection);
				} else {
					$.ajax({
						url: "/geodata",
						data: selection,
						dataType: 'json',
						success: function(data){
							// data = {'San Francisco': 4, 'Los Angeles': 10, 'San Diego': 3}
							choropleth.insert(data, selection);
							choropleth.render(selection);
						}
					});
				};
			}
		})
	</script>
</body>
</html>